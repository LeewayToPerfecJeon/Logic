package cpt;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.util.ArrayList;

//apparently we can't make the AI perfect sooooo
public class CPT {

    static ArrayList<Integer> numbers = new ArrayList<>();
    static ArrayList<Player> players = new ArrayList<>();

    static BufferedReader br = new BufferedReader(new InputStreamReader(System.in));

    public static void main(String[] args) throws IOException {

        int currentNumber;
        int chipPool = 0;
        int trigger = 0;
        System.out.println("Minus Auction");

        //you; i=0
        createPlayer();
        //AI 1; i=1
        createPlayer();
        //AI 2; i=2
        createPlayer();

        numbers = createNumbers();

        int hiddenCube = pickHiddenCube(numbers);

        currentNumber = getNumber(numbers);
        System.out.println("Number: " + currentNumber);

        //figure out how you're gonna clear the chip pool when somebody accepts the number**
        //1st turn 
        //so if the player accepts the number
        if (wantNumber(currentNumber, (players.get(0)).getMyNumbers(), (players.get(0).getChips()), chipPool) == true) {
            System.out.print((players.get(0)).getMyNumbers());
            System.out.println(", " + (players.get(0)).getChips());

            //new number
            currentNumber = getNumber(numbers);
            System.out.println("Number: " + currentNumber);
            if (AILogic3(currentNumber) == true) {

                receiveNumber(1, currentNumber, chipPool);

                System.out.print("AI #1: " + (players.get(1)).getMyNumbers());
                System.out.println(", " + (players.get(1)).getChips());
            } else {
                (players.get(1)).setChips((players.get(1)).getChips() - 1);
                chipPool++;
                if (AILogic3(currentNumber) == true) {
                    receiveNumber(2, currentNumber, chipPool);
                    System.out.print("AI #2: " + (players.get(2)).getMyNumbers());
                    System.out.println(", " + (players.get(2)).getChips());
                } else {
                    (players.get(2)).setChips((players.get(2)).getChips() - 1);
                    chipPool++;

                    // we have to have a loop in here if AI doesn't accept the number 
                    //goes back to the user's turn 
                    //I think we also have to change logics here for the AIs cause the "first turn" is over
                    //so put all the AI logic in here except for AI #2 and when AI #2 accepts, get out of the loop
                    //EXCEPT FOR AI #2**
                }

            }

        } //if the player does not accept the number
        //make sure the current number didn't change
        //does this really need two repetitions of itself? Can't think right now
        //REMINDER: NEED THE OTHER AI LOGIC METHODS IN HERE TOO in the inner-most else loop 
        //I think AILogic2?
        else {
            chipPool++;
            if (AILogic3(currentNumber) == true) {
                receiveNumber(1, currentNumber, chipPool);
                chipPool = 0;
                System.out.print("AI #1: " + (players.get(1)).getMyNumbers());
                System.out.println(", " + (players.get(1)).getChips());
            } else {

                (players.get(1)).setChips((players.get(1)).getChips() - 1);
                chipPool++;

                if (AILogic3(currentNumber) == true) {
                    receiveNumber(2, currentNumber, chipPool);
                    chipPool = 0;
                    System.out.print("AI #2: " + (players.get(2)).getMyNumbers());
                    System.out.println(", " + (players.get(2)).getChips());
                } else {

                    (players.get(2)).setChips((players.get(2)).getChips() - 1);
                    chipPool++;

                    do {
                        if (wantNumber(currentNumber, (players.get(0)).getMyNumbers(), (players.get(0).getChips()), chipPool) == true) {

                            System.out.print((players.get(0)).getMyNumbers());
                            System.out.println(", " + (players.get(0)).getChips());
                            trigger = 1;
                            chipPool = 0;
                        } else {
                            //chip from the user
                            chipPool++;

                            if (AILogic3(currentNumber) == true) {

                                receiveNumber(1, currentNumber, chipPool);

                                System.out.print("AI #1: " + (players.get(1)).getMyNumbers());
                                System.out.println(", " + (players.get(1)).getChips());
                                trigger = 1;
                                chipPool = 0;
                            } else {

                                (players.get(1)).setChips((players.get(1)).getChips() - 1);
                                chipPool++;

                                if (AILogic3(currentNumber) == true) {

                                    receiveNumber(2, currentNumber, chipPool);

                                    System.out.print("AI #2: " + (players.get(2)).getMyNumbers());
                                    System.out.println(", " + (players.get(2)).getChips());
                                } else {

                                    (players.get(2)).setChips((players.get(2)).getChips() - 1);
                                    chipPool++;

                                }
                            }
                        }
                    } while (trigger == 0);

                }

            }
        }
        //need to have a new number here only if they're from the else loop..? 

        printPlayers();
        System.out.println("Number of chips in the chip pool: " + chipPool);
    }

    public static void printPlayers() {
        for (int i = 0; i < players.size(); i++) {
            System.out.println(players.get(i));
        }
    }

    public static void createPlayer() {
        int chips = 7;
        ArrayList<Integer> myNumbers = new ArrayList<>();

        players.add(new Player(chips, myNumbers));

    }

    //to be built
    public static void passNumber() {

    }

    //AI methods
    public static boolean AILogic1(ArrayList<Integer> x, int y, ArrayList<Integer> player1, ArrayList<Integer> player2) {
        //true = take; false = pass        
        //x being my arraylist of numbers
        //y being the number that's picked for that round

        //for loop to check whether to let the number go around once to collect chips 
        for (int i = 0; i < x.size(); i++) {
            //first check if they're 1 away from mine
            if ((x.get(i)) == (y + 1) || x.get(i) == (y - 1)) {
                //then check if other people need it + number of chips in the pool
                for (int j = 0; j < player1.size(); j++) {
                    //so if the number is NOT 1 or 2 up from any number the other players have, 
                    //pass the number so that you can collect more chips 
                    //QUESTION: does it matter if the number is small and other people take it? 
                    if ((x.get(j)) != (y + 1) || x.get(j) != (y - 1) || x.get(j) != (y - 2) || x.get(j) != (y + 2)) {
                        for (int k = 0; k < player2.size(); k++) {
                            if ((x.get(k)) != (y + 1) || x.get(k) != (y - 1) || x.get(k) != (y - 2) || x.get(k) != (y + 2)) {
                                return false;
                            }
                        }
                    }
                }

            }

        }

        return true;

    }

    //method must be used after being checked for possible consecutive numbers
    public static boolean AILogic4(ArrayList<Integer> x, int y, ArrayList<Integer> player1, ArrayList<Integer> player2) {
        //check if the number is related to other players so that you can ruin their lives
        //y = current number
        //so 1 or 2 away from any number they have 
        //or should I check if it's the middle number of 3 consecutive numbers? 
        for (int i = 0; i < player1.size(); i++) {
            if (player1.get(i) == (y - 1) || player1.get(i) == (y + 1) || player1.get(i) == (y - 2) || player1.get(i) == (y + 2)) {

            }
        }
        for (int j = 0; j < player2.size(); j++) {
            if (player2.get(j) == (y - 1) || player2.get(j) == (y + 1) || player2.get(j) == (y - 2) || player2.get(j) == (y + 2)) {

            }
        }
        for (int k = 0; k < player1.size(); k++) {
            //...this is more complicated than I thought 
        }
        return false;
    }

    //x= # of chips in the pool
    //y = the # for that round
    public static boolean AILogic2(int x, int y) {
        if (x >= y) {
            return true;
        }

        return true;
    }

    //only for the FIRST TURN, to decide whether to take the number or not
    //QUESTION: does this really only apply to the first turn tho?
    public static boolean AILogic3(int x) {
        if (x > -11) {
            return true;
        }
        return false;
    }

    //game methods
    public static <Integer> ArrayList createNumbers() {

        for (int i = -1; i > -21; i--) {
            numbers.add(i);
        }
        return numbers;
    }

    //only need this method for the player b/c it's already initialized for the AI
    public static int initializeChips() {
        //we can always change this number
        return 7;

    }

    public static int getNumber(ArrayList<Integer> x) {
        int upperbound = (x.size() - 1);
        int lowerbound = 0;
        int index = (int) (Math.random() * ((upperbound - lowerbound) + 1) + lowerbound);
        int number = x.get(index);
        //remove removes the number and the numbers after that all move one spot to the left right
        x.remove(index);
        return number;

    }

    public static int pickHiddenCube(ArrayList<Integer> x) {
        int upperbound = (x.size() - 1);
        int lowerbound = 0;
        int index = (int) (Math.random() * ((upperbound - lowerbound) + 1) + lowerbound);
        int hiddenCube = x.get(index);
        x.remove(index);
        return hiddenCube;
    }

    //do we really need classes for this tho? Do we have to use it?
    // x=number list; y=your numbers list; z=your number of chips; a=chip pool for that number
    //have to initialize a=0 before using this method
    //not within this method b/c it will reset if the user inputs an invalid answer
    //maybe we should rename the arraylist parameters so that we know what they are 
    //
    //
    //NEED TO FIX - DOESNT RETURN THE # of CHIPS IN THE POOL
    //
    public static boolean wantNumber(int x, ArrayList<Integer> y, int z, int a) throws IOException {
        System.out.println("Would you like to take the number?");
        String answer = br.readLine();
        if (answer.equalsIgnoreCase("yes")) {
            //get number
            y.add(x);
            //get the pooled chips
            (players.get(0)).setChips((players.get(0)).getChips() + a);
            return true;
        } else {
            (players.get(0)).setChips((players.get(0)).getChips() - 1);

            return false;
        }

    }

    //for AI only
    //x = AI number
    //y = current number
    //z = # of chips in the pool
    public static void receiveNumber(int x, int y, int z) {

        ((players.get(x)).getMyNumbers()).add(y);
        (players.get(x)).setChips((players.get(x)).getChips() + z);

    }

    //x being your list of numbers that you have 
    //to be used at the end of the game to count points, not before
    public static int finalCheckConsecutive(ArrayList<Integer> x) {
        int total = 0;
        //wait need to sort the list into numerical order first 
        for (int i = 0; i < x.size() - 1; i++) {
            if (x.get(i) == (x.get(i + 1)) + 1) {
                for (int k = 1; k < x.size() - i; k++) {
                    if (x.get(i) == x.get(k)) {
                        x.set(k, 0);
                        //dunno if this works 
                    }
                }

            }

        }
        //get total
        for (int a = 0; a < x.size(); a++) {
            total = total + x.get(a);
        }
        return total;
    }

    public static int finalTotal(int total, int chips) {
        return total + chips;

    }

    public static void checkWinner(int total1, int total2, int total3) {
        if (total1 > total2 && total1 > total3) {
            //assuming that the player will be set as player #1
            System.out.println("You have won.");
        } else if (total2 > total1 && total2 > total3) {
            System.out.println("Player 2 has won.");
        } else {
            System.out.println("Player 3 has won.");
        }
    }

    public static boolean checkChips(int chips) {
        if (chips == 0) {
            System.out.println("You do not have enough chips to skip this number.");
            return false;
            //then after this it would automatically run the getNumber method
        } else {
            return true;
        }
    }

}
